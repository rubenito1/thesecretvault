const key = localStorage.getItem("vault_key");

fetch("panel.enc")
  .then(r => r.text())
  .then(enc => {
    try {
      // Limpiar saltos de línea extra
      enc = enc.trim();
      const bytes = CryptoJS.AES.decrypt(enc, key);
      const decrypted = bytes.toString(CryptoJS.enc.Utf8);

      if (!decrypted || decrypted.length < 5) {
        document.getElementById("content").innerHTML =
          "<h2>Acceso denegado</h2><p>Contraseña incorrecta.</p>";
        return;
      }

      document.getElementById("content").innerHTML = decrypted;
    } catch (e) {
      document.getElementById("content").innerHTML =
        "<h2>Acceso denegado</h2><p>Error de descifrado.</p>";
      console.error(e);
    }
  });
