<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Panel – The Secret Vault</title>
<link rel="stylesheet" href="styles.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
</head>
<body class="panel-body">

<div id="loader" class="loader-screen">
    <div class="spinner"></div>
    <p>Cargando panel seguro...</p>
</div>

<div id="content" class="hidden"></div>

<script>
const key = localStorage.getItem("vault_key");
if (!key) window.location.href = "index.html";

const files = [
    "vault/panel-A.enc",
    "vault/panel-B.enc",
    "vault/panel-C.enc",
    "vault/panel-D.enc",
    "vault/panel-E.enc",
    "vault/panel-F.enc",
    "vault/panel-G.enc",
    "vault/panel-H.enc",
    "vault/panel-I.enc",
    "vault/panel-J.enc"
];

async function tryDecrypt() {
    for (const file of files) {
        try {
            const enc = await fetch(file).then(r => r.text());
            const dec = CryptoJS.AES.decrypt(enc, key).toString(CryptoJS.enc.Utf8);
            if (dec && dec.length > 20) return dec;
        } catch {}
    }
    return null;
}

(async () => {
    const result = await tryDecrypt();

    const delay = 200 + Math.random() * 1800;
    setTimeout(() => {
        document.getElementById("loader").style.display = "none";

        if (!result) {
            document.body.innerHTML = "<h2 style='color:white;text-align:center;margin-top:50px;'>Acceso denegado</h2>";
            return;
        }

        document.getElementById("content").innerHTML =
            result + `<button onclick="logout()" class='logout'>Cerrar sesión</button>`;
        document.getElementById("content").classList.remove("hidden");
    }, delay);
})();

function logout() {
    localStorage.clear();
    window.location.href = "index.html";
}
</script>

</body>
</html>
